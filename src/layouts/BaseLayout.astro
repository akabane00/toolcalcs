---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEOHead from '../components/SEOHead.astro';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
  structuredData?: object | object[];
}

const props = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEOHead {...props} />
  <!-- AdSense verification only - script loaded after page render -->
  <meta name="google-adsense-account" content="ca-pub-1658942662433818">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <Header />
  <main class="site-main" id="main-content">
    <slot />
  </main>
  <Footer />
  <!-- Third-party scripts deferred until after page is interactive -->
  <script>
    function loadThirdParty() {
      // Google Analytics 4
      var gs = document.createElement('script');
      gs.src = 'https://www.googletagmanager.com/gtag/js?id=G-M0BQJJYZPX';
      gs.async = true;
      document.head.appendChild(gs);
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', 'G-M0BQJJYZPX');

      // Google AdSense
      var as = document.createElement('script');
      as.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1658942662433818';
      as.async = true;
      as.crossOrigin = 'anonymous';
      document.head.appendChild(as);
    }
    if ('requestIdleCallback' in window) {
      requestIdleCallback(loadThirdParty);
    } else {
      setTimeout(loadThirdParty, 2000);
    }

    // Register Service Worker for PWA / offline support
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(function(){});
    }
  </script>
</body>
</html>

<style>
  .site-main {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 32px 20px;
    flex: 1;
  }
</style>
