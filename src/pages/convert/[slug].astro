---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdUnit from '../../components/AdUnit.astro';
import '../../styles/calculator.css';
import {
  conversionPairs, getUnit, convert, getCommonValues, fmt,
  categoryNames, type Unit,
} from '../../data/unit-conversions';

export function getStaticPaths() {
  return conversionPairs.map(([fromSlug, toSlug]) => ({
    params: { slug: `${fromSlug}-to-${toSlug}` },
    props: { fromSlug, toSlug },
  }));
}

const { fromSlug, toSlug } = Astro.props;
const from = getUnit(fromSlug)!;
const to = getUnit(toSlug)!;
const isTemp = from.category === 'temperature';
const catName = categoryNames[from.category];

// Conversion data (computed at build time)
const factor = convert(1, fromSlug, toSlug);
const factorStr = fmt(factor);
const reverseFactorStr = fmt(convert(1, toSlug, fromSlug));
const commonValues = getCommonValues(fromSlug, toSlug);
const tableRows = commonValues.map(v => ({ from: v, to: convert(v, fromSlug, toSlug) }));

// SEO metadata
const title = `${from.name} to ${to.name} Converter - ${from.abbrev} to ${to.abbrev} | ToolCalcs`;
const description = `Convert ${from.name.toLowerCase()} to ${to.name.toLowerCase()} instantly. Free ${from.abbrev} to ${to.abbrev} converter with formula, conversion table, and common values. 1 ${from.abbrev} = ${factorStr} ${to.abbrev}.`;
const reverseSlug = `${toSlug}-to-${fromSlug}`;

// Formula string
let formulaText: string;
if (isTemp) {
  if (fromSlug === 'celsius' && toSlug === 'fahrenheit') formulaText = `${to.abbrev} = (${from.abbrev} \u00D7 9/5) + 32`;
  else if (fromSlug === 'fahrenheit' && toSlug === 'celsius') formulaText = `${to.abbrev} = (${from.abbrev} \u2212 32) \u00D7 5/9`;
  else if (fromSlug === 'celsius' && toSlug === 'kelvin') formulaText = `${to.abbrev} = ${from.abbrev} + 273.15`;
  else if (fromSlug === 'kelvin' && toSlug === 'celsius') formulaText = `${to.abbrev} = ${from.abbrev} \u2212 273.15`;
  else if (fromSlug === 'fahrenheit' && toSlug === 'kelvin') formulaText = `${to.abbrev} = (${from.abbrev} \u2212 32) \u00D7 5/9 + 273.15`;
  else formulaText = `${to.abbrev} = (${from.abbrev} \u2212 273.15) \u00D7 9/5 + 32`;
} else {
  formulaText = `${to.name} = ${from.name} \u00D7 ${factorStr}`;
}

// Related conversions (same category, different pairs)
const relatedPairs = conversionPairs
  .filter(([f, t]) => {
    const u = getUnit(f)!;
    return u.category === from.category && !(f === fromSlug && t === toSlug) && !(f === toSlug && t === fromSlug);
  })
  .slice(0, 8);

// Structured data
const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://toolcalcs.com/" },
      { "@type": "ListItem", "position": 2, "name": "Unit Converter", "item": "https://toolcalcs.com/conversion-calculators/unit-converter/" },
      { "@type": "ListItem", "position": 3, "name": `${from.name} to ${to.name}` },
    ],
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": `How many ${to.name.toLowerCase()} ${isTemp ? 'is' : 'are in'} 1 ${from.name.toLowerCase().replace(/\(us\)/, '').trim()}?`,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": `1 ${from.abbrev} is equal to ${factorStr} ${to.abbrev}. To convert ${from.name.toLowerCase()} to ${to.name.toLowerCase()}, ${isTemp ? 'use the formula: ' + formulaText : 'multiply the value by ' + factorStr}.`,
        },
      },
      {
        "@type": "Question",
        "name": `How do you convert ${from.name.toLowerCase()} to ${to.name.toLowerCase()}?`,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": `To convert ${from.name.toLowerCase()} to ${to.name.toLowerCase()}, ${isTemp ? 'use the formula: ' + formulaText + '.' : 'multiply the ' + from.name.toLowerCase() + ' value by ' + factorStr + '.'} For example, ${fmt(commonValues[3] ?? 10)} ${from.abbrev} = ${fmt(convert(commonValues[3] ?? 10, fromSlug, toSlug))} ${to.abbrev}.`,
        },
      },
      {
        "@type": "Question",
        "name": `What is ${fmt(commonValues[4] ?? 100)} ${from.name.toLowerCase()} in ${to.name.toLowerCase()}?`,
        "acceptedAnswer": {
          "@type": "Answer",
          "text": `${fmt(commonValues[4] ?? 100)} ${from.abbrev} is equal to ${fmt(convert(commonValues[4] ?? 100, fromSlug, toSlug))} ${to.abbrev}.`,
        },
      },
    ],
  },
];

// Category-specific use-case paragraphs
const useCases: Record<string, string> = {
  length: `Length conversions between ${from.name.toLowerCase()} and ${to.name.toLowerCase()} are commonly needed in construction, interior design, manufacturing, and international shipping. Engineers and architects regularly convert between metric and imperial length units when working with international specifications. If you are buying furniture from a European retailer, product dimensions may be listed in centimeters or meters, and you will need to convert to feet or inches to visualize the size in your space. Similarly, runners training for international races need to convert between miles and kilometers to track their distances accurately.`,
  weight: `Weight conversions between ${from.name.toLowerCase()} and ${to.name.toLowerCase()} are essential in cooking, shipping, health monitoring, and international trade. Recipes from different countries use different weight units, and precise conversion ensures your dishes turn out correctly. If you are shipping packages internationally, carriers often require weight in kilograms, while domestic shipments in the US use pounds. Healthcare professionals frequently convert between metric and imperial weight units when reviewing patient records or medication dosages from international sources.`,
  temperature: `Temperature conversions between ${from.name.toLowerCase()} and ${to.name.toLowerCase()} are needed daily when checking weather forecasts from international sources, cooking with recipes that use different temperature scales, and working in scientific or engineering fields. Travelers between the US and other countries need to convert Fahrenheit to Celsius to understand local weather reports. Bakers and chefs converting international recipes must accurately translate oven temperatures between scales. Scientists and engineers worldwide use Celsius and Kelvin as standard units, making conversion from Fahrenheit necessary for American researchers collaborating internationally.`,
  volume: `Volume conversions between ${from.name.toLowerCase()} and ${to.name.toLowerCase()} are frequently used in cooking, chemistry, automotive maintenance, and beverage production. Recipes from international sources may list liquid ingredients in milliliters or liters, while American cooks measure in cups, pints, and gallons. Automotive fluids like engine oil and coolant are often sold in different volume units depending on the country. Bartenders and brewers regularly convert between fluid ounces, liters, and gallons when scaling recipes or ordering ingredients in bulk.`,
};
---

<BaseLayout title={title} description={description} type="article" structuredData={structuredData}>
  <nav class="breadcrumb">
    <a href="/">Home</a> &rsaquo;
    <a href="/conversion-calculators/unit-converter/">Unit Converter</a> &rsaquo;
    <span>{from.name} to {to.name}</span>
  </nav>

  <h1>{from.name} to {to.name} Converter</h1>
  <p class="page-desc">Instantly convert {from.name.toLowerCase()} ({from.abbrev}) to {to.name.toLowerCase()} ({to.abbrev}) with our free converter.</p>

  <!-- Quick Fact -->
  <div class="quick-fact">
    <span class="quick-fact-label">Quick Answer:</span>
    <strong>1 {from.abbrev} = {factorStr} {to.abbrev}</strong>
  </div>

  <!-- Converter -->
  <div class="calculator-box">
    <div class="calc-inputs converter-row">
      <div class="input-group">
        <label for="fromValue">{from.name} ({from.abbrev})</label>
        <input type="number" id="fromValue" value="1" step="any" />
      </div>
      <div class="swap-cell">
        <button class="swap-btn" id="swapBtn" title="Swap units">&#8646;</button>
      </div>
      <div class="input-group">
        <label for="toValue">{to.name} ({to.abbrev})</label>
        <input type="number" id="toValue" step="any" readonly />
      </div>
    </div>
    <div class="conversion-summary" id="conversionSummary"></div>
  </div>

  <!-- Conversion Table -->
  <h2 class="section-heading">{from.name} to {to.name} Conversion Table</h2>
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>{from.name} ({from.abbrev})</th>
          <th>{to.name} ({to.abbrev})</th>
        </tr>
      </thead>
      <tbody>
        {tableRows.map(row => (
          <tr>
            <td>{fmt(row.from)}</td>
            <td>{fmt(row.to)}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <AdUnit slot="convert-mid" format="rectangle" />

  <!-- SEO Content -->
  <article class="content-section">
    <h2>How to Convert {from.name} to {to.name}</h2>
    {isTemp ? (
      <p>To convert {from.name.toLowerCase()} to {to.name.toLowerCase()}, use the following formula:</p>
      <div class="formula-box"><code>{formulaText}</code></div>
      <p>For example, to convert {fmt(commonValues[3] ?? 10)} {from.abbrev} to {to.name.toLowerCase()}: plug the value into the formula and you get {fmt(convert(commonValues[3] ?? 10, fromSlug, toSlug))} {to.abbrev}. Unlike length or weight conversions, temperature conversion is not a simple multiplication because the Celsius, Fahrenheit, and Kelvin scales have different zero points and different degree sizes.</p>
    ) : (
      <p>To convert {from.name.toLowerCase()} to {to.name.toLowerCase()}, multiply the value in {from.name.toLowerCase()} by {factorStr}. The conversion formula is:</p>
      <div class="formula-box"><code>{formulaText}</code></div>
      <p>For example, {fmt(commonValues[3] ?? 10)} {from.abbrev} &times; {factorStr} = {fmt(convert(commonValues[3] ?? 10, fromSlug, toSlug))} {to.abbrev}. To convert in the other direction ({to.name.toLowerCase()} to {from.name.toLowerCase()}), divide by {factorStr} or multiply by {reverseFactorStr}.</p>
    )}

    <h2>When You Need This Conversion</h2>
    <p>{useCases[from.category]}</p>

    <h2>Frequently Asked Questions</h2>

    <h3>How many {to.name.toLowerCase()} {isTemp ? 'is' : 'are in'} 1 {from.name.toLowerCase().replace(/\(us\)/, '').trim()}?</h3>
    <p>There {isTemp ? 'is' : (factor === 1 ? 'is' : 'are')} {factorStr} {to.name.toLowerCase()} in 1 {from.name.toLowerCase().replace(/\(us\)/, '').trim()}. This conversion factor is exact{isTemp ? '' : ` and based on the international standard definition of ${from.name.toLowerCase()}`}.</p>

    <h3>How do I convert {from.name.toLowerCase()} to {to.name.toLowerCase()}?</h3>
    <p>{isTemp
      ? `Use the formula: ${formulaText}. Enter your ${from.name.toLowerCase()} value, apply the formula, and you will get the equivalent ${to.name.toLowerCase()} value. Or simply use the converter at the top of this page for instant results.`
      : `Multiply your ${from.name.toLowerCase()} value by ${factorStr} to get the result in ${to.name.toLowerCase()}. For quick conversions, use the table above or the converter at the top of this page.`
    }</p>

    <h3>What is {fmt(commonValues[5] ?? 50)} {from.abbrev} in {to.name.toLowerCase()}?</h3>
    <p>{fmt(commonValues[5] ?? 50)} {from.abbrev} is equal to {fmt(convert(commonValues[5] ?? 50, fromSlug, toSlug))} {to.abbrev}.</p>

    <h2>Related Conversions</h2>
    <ul>
      <li><a href={`/convert/${reverseSlug}/`}>{to.name} to {from.name} (reverse)</a></li>
      {relatedPairs.map(([f, t]) => {
        const fu = getUnit(f)!;
        const tu = getUnit(t)!;
        return <li><a href={`/convert/${f}-to-${t}/`}>{fu.name} to {tu.name}</a></li>;
      })}
      <li><a href="/conversion-calculators/unit-converter/">Full Unit Converter</a></li>
    </ul>
  </article>

  <AdUnit slot="convert-bottom" format="horizontal" />
</BaseLayout>

<style>
  .quick-fact {
    background: #eff6ff;
    border-radius: var(--radius);
    padding: 16px 24px;
    margin-bottom: 24px;
    font-size: 1.1rem;
  }
  .quick-fact-label {
    font-size: 0.85rem;
    color: var(--color-text-muted);
    display: block;
    margin-bottom: 4px;
  }
  .quick-fact strong {
    color: var(--color-primary);
    font-size: 1.3rem;
  }

  .converter-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: end;
    gap: 12px;
  }
  .swap-cell {
    display: flex;
    align-items: center;
    padding-bottom: 2px;
  }
  .swap-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    font-size: 1.4rem;
    cursor: pointer;
    color: var(--color-text);
    transition: all 0.15s;
    line-height: 1;
  }
  .swap-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    background: #eff6ff;
  }

  .conversion-summary {
    text-align: center;
    font-size: 0.95rem;
    color: var(--color-text-muted);
    padding: 12px;
    background: var(--color-bg);
    border-radius: var(--radius);
    margin-top: 16px;
    min-height: 20px;
  }

  .section-heading {
    font-size: 1.2rem;
    margin: 32px 0 12px;
  }

  @media (max-width: 640px) {
    .converter-row {
      grid-template-columns: 1fr;
    }
    .swap-cell {
      justify-content: center;
    }
  }
</style>

<script define:vars={{
  convFactor: factor,
  isTemp,
  tempFrom: fromSlug,
  tempTo: toSlug,
  fromAbbr: from.abbrev,
  toAbbr: to.abbrev,
  reverseSlug,
}}>
  function convertTemp(val, from, to) {
    if (from === to) return val;
    var c;
    if (from === 'celsius') c = val;
    else if (from === 'fahrenheit') c = (val - 32) * 5 / 9;
    else c = val - 273.15;
    if (to === 'celsius') return c;
    if (to === 'fahrenheit') return c * 9 / 5 + 32;
    return c + 273.15;
  }

  function doConvert(val) {
    if (isTemp) return convertTemp(val, tempFrom, tempTo);
    return val * convFactor;
  }

  function doReverseConvert(val) {
    if (isTemp) return convertTemp(val, tempTo, tempFrom);
    return val / convFactor;
  }

  function formatNum(n) {
    if (Number.isInteger(n)) return n.toLocaleString('en-US');
    if (Math.abs(n) >= 100) return n.toLocaleString('en-US', { maximumFractionDigits: 2 });
    if (Math.abs(n) >= 1) return n.toLocaleString('en-US', { maximumFractionDigits: 4 });
    if (Math.abs(n) >= 0.01) return n.toLocaleString('en-US', { maximumFractionDigits: 6 });
    return n.toExponential(4);
  }

  var fromInput = document.getElementById('fromValue');
  var toInput = document.getElementById('toValue');
  var summaryEl = document.getElementById('conversionSummary');

  function updateResult() {
    var val = parseFloat(fromInput.value);
    if (isNaN(val)) {
      toInput.value = '';
      summaryEl.textContent = '';
      return;
    }
    var result = doConvert(val);
    toInput.value = formatNum(result);
    summaryEl.textContent = formatNum(val) + ' ' + fromAbbr + ' = ' + formatNum(result) + ' ' + toAbbr;
  }

  fromInput.addEventListener('input', updateResult);

  document.getElementById('swapBtn').addEventListener('click', function () {
    window.location.href = '/convert/' + reverseSlug + '/';
  });

  // Calculate on load
  updateResult();
</script>
