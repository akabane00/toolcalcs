---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdUnit from '../../components/AdUnit.astro';
import { getGameBySlug } from '../../data/games';
import '../../styles/game.css';

const game = getGameBySlug('chimp-test')!;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://toolcalcs.com/" },
    { "@type": "ListItem", "position": 2, "name": "Tests & Games", "item": "https://toolcalcs.com/test/" },
    { "@type": "ListItem", "position": 3, "name": "Chimp Test" }
  ]
};
---

<BaseLayout
  title="Chimp Test - Are You Smarter Than a Chimpanzee? | ToolCalcs"
  description="The Chimp Test challenges you to remember number positions on a grid. Inspired by Ayumu the chimpanzee who outperforms most humans. Free online memory test."
  type="article"
  structuredData={structuredData}
>
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="/">Home</a> &rsaquo;
    <a href="/test/">Tests & Games</a> &rsaquo;
    <span>Chimp Test</span>
  </nav>

  <h1>Chimp Test</h1>
  <p class="page-desc">Numbers will appear on the grid. Once you click the first number, the rest hide. Click them all in ascending order.</p>

  <div class="game-box">
    <div class="game-area" id="gameArea" role="region" aria-label="Chimp test area" aria-live="polite">
      <div class="game-instructions" id="instructionsView">
        <h2>Chimp Test</h2>
        <p>Numbers will appear on a grid. Click them in order from 1 to N. After you click the first number, the rest will be hidden. Can you beat a chimpanzee?</p>
        <p style="font-size:0.85rem;color:var(--color-text-muted);">You have 3 strikes.</p>
        <button class="game-btn primary" id="startBtn" type="button" style="margin-top:16px;">Start Test</button>
      </div>

      <div class="play-view" id="playView" style="display:none;">
        <div class="status-bar">
          <span class="level-info" id="levelInfo">Numbers: 4</span>
          <span class="lives-info" id="livesInfo">‚ùå 0 / 3</span>
        </div>
        <div class="chimp-grid" id="chimpGrid" role="grid" aria-label="Number grid"></div>
      </div>

      <div class="result-view" id="resultView" style="display:none;">
        <div class="result-icon" aria-hidden="true">üêµ</div>
        <div class="result-label">Game Over</div>
        <div class="score-display">
          <span class="score-value" id="finalScore">0</span>
          <span class="score-unit">numbers remembered</span>
        </div>
        <div class="rating-badge" id="ratingBadge">‚Äî</div>
        <button class="game-btn primary" id="tryAgainBtn" type="button" style="margin-top:16px;">Try Again</button>
      </div>
    </div>

    <div class="attempt-history" id="attemptHistory" hidden>
      <h3>Attempt History</h3>
      <div class="history-list" id="historyList"></div>
    </div>
  </div>

  <AdUnit slot="game-mid" format="horizontal" />

  <article class="content-section">
    <h2>What Is the Chimp Test?</h2>
    <p>The Chimp Test is inspired by a famous experiment conducted at the Primate Research Institute of Kyoto University. In 2007, researcher Tetsuro Matsuzawa published a study showing that a young chimpanzee named Ayumu could memorize the positions of numbers flashed briefly on a screen and then correctly tap them in sequence ‚Äî faster and more accurately than human adults.</p>
    <p>This test replicates that challenge. Numbers appear on a grid, and after you click the first one, the remaining numbers are hidden. You must remember their positions and click them in ascending order. The number of digits increases with each successful round, testing the limits of your visual short-term memory and spatial recall.</p>

    <h2>How This Test Works</h2>
    <p>The test begins with 4 numbers displayed on a grid. All numbers are visible when the round starts. When you click the first number (1), all other numbers are hidden behind blank tiles. You must then click the remaining tiles in the correct ascending order from memory.</p>
    <ul>
      <li><strong>4-5 numbers:</strong> Most people can handle this level comfortably.</li>
      <li><strong>6-7 numbers:</strong> Challenging for most adults. Ayumu the chimpanzee performs reliably at this level even with 210ms exposure times.</li>
      <li><strong>8-9 numbers:</strong> Requires excellent visual-spatial memory. Few untrained humans reach this level consistently.</li>
      <li><strong>10+ numbers:</strong> Exceptional performance that matches or exceeds what most chimpanzees achieve.</li>
    </ul>
    <p>You have 3 strikes. Each incorrect click costs one strike. On a strike, you retry the same level. After 3 strikes, the game ends and your highest completed level is your score.</p>

    <h2>Why Chimps Outperform Humans</h2>
    <p>The finding that chimpanzees can outperform humans on this task surprised many researchers and challenged assumptions about human cognitive superiority. Several hypotheses explain this advantage:</p>
    <h3>Eidetic (Photographic) Memory</h3>
    <p>Young chimpanzees appear to possess a form of eidetic memory ‚Äî the ability to retain a vivid, detailed image of a visual scene after very brief exposure. This type of memory is present in some human children but typically fades with age and the development of language-based memory strategies.</p>
    <h3>The Cognitive Tradeoff Hypothesis</h3>
    <p>Matsuzawa proposed the "cognitive tradeoff hypothesis," suggesting that as humans evolved language and complex symbolic thinking, we lost some of the raw visual memory capacity that our primate relatives retained. In essence, our brains traded spatial memory capacity for language processing ability.</p>
    <h3>Processing Strategy</h3>
    <p>Humans tend to process information sequentially and verbally (mentally saying "1 is top-left, 2 is middle-right..."), while chimpanzees may process the entire visual scene holistically and simultaneously. The sequential verbal strategy is slower and more prone to error than direct spatial mapping.</p>

    <h2>Tips to Improve Your Score</h2>
    <ul>
      <li><strong>Take a mental snapshot:</strong> Instead of reading the numbers sequentially, try to absorb the entire pattern at once before clicking.</li>
      <li><strong>Use spatial memory:</strong> Focus on the positions relative to each other and the grid edges, not on individual locations.</li>
      <li><strong>Start quickly:</strong> The longer you wait before clicking the first number, the more the memory trace fades. Click #1 as soon as you've encoded the pattern.</li>
      <li><strong>Practice regularly:</strong> Visual-spatial memory is trainable. Regular practice has been shown to improve performance over time.</li>
      <li><strong>Chunk the numbers:</strong> Group nearby numbers into clusters. Instead of 9 individual positions, think of 3 groups of 3.</li>
    </ul>

    <h2>The Original Ayumu Study</h2>
    <p>In Matsuzawa's original experiment, numbers 1-9 were displayed on a touchscreen for just 210 milliseconds (about one-fifth of a second) before being masked. Ayumu correctly recalled the sequence about 80% of the time at this speed, while human university students performed significantly worse.</p>
    <p>The study has been replicated many times and remains one of the most compelling demonstrations that non-human primates can outperform humans on specific cognitive tasks. It has influenced research on memory, evolution, and the relationship between language and cognition.</p>
    <p>Interestingly, Ayumu's mother Ai, an adult chimpanzee, performed more like humans ‚Äî suggesting that this exceptional visual memory may be an age-dependent trait in chimpanzees, just as eidetic memory is more common in human children than adults.</p>

    <h2>Frequently Asked Questions</h2>

    <h3>What is a good Chimp Test score?</h3>
    <p>Most untrained adults can reliably remember 5-7 numbers. Scores of 8-9 indicate strong visual-spatial memory, and 10+ is exceptional. Ayumu the chimpanzee could consistently handle 9 numbers at very brief exposure times.</p>

    <h3>Can practice improve my score?</h3>
    <p>Yes. Research shows that visual-spatial working memory is trainable. Regular practice, combined with strategic approaches like chunking and holistic encoding, can lead to significant improvements over weeks of training.</p>

    <h3>Why is this test sometimes called the "Are You Smarter Than a Chimp" test?</h3>
    <p>The test went viral after media coverage highlighted that chimpanzees outperformed humans on this specific memory task. While the comparison is somewhat misleading (it tests only one narrow type of memory), it effectively demonstrates that human cognitive abilities are not universally superior to those of other primates.</p>
  </article>

  <AdUnit slot="game-bottom" format="horizontal" />
</BaseLayout>

<style>
  .game-area { cursor: default; user-select: auto; -webkit-user-select: auto; }

  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    margin-bottom: 8px;
  }
  .level-info { font-weight: 700; font-size: 1rem; color: var(--color-text); }
  .lives-info { font-size: 0.95rem; font-weight: 600; color: var(--color-text-muted); }

  .chimp-grid {
    display: grid;
    gap: 4px;
    padding: 12px;
    max-width: 420px;
    margin: 0 auto;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(5, 1fr);
  }
  :global(.chimp-cell) {
    aspect-ratio: 1;
    border-radius: 6px;
    border: none;
    padding: 0;
    font-size: 1.1rem;
    font-weight: 800;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    color: transparent;
    transition: background 0.15s, transform 0.1s;
  }
  :global(.chimp-cell.has-number) {
    background: var(--color-primary);
    color: #fff;
    cursor: pointer;
  }
  :global(.chimp-cell.has-number.hidden-num) {
    background: var(--color-border);
    color: transparent;
  }
  :global(.chimp-cell.has-number.hidden-num:hover) {
    background: var(--color-text-muted);
    transform: scale(0.95);
  }
  :global(.chimp-cell.correct-cell) {
    background: #22c55e;
    color: #fff;
    cursor: default;
  }
  :global(.chimp-cell.wrong-cell) {
    background: #ef4444;
    color: #fff;
    animation: wrongPulse 0.4s ease;
  }
  @keyframes wrongPulse {
    25% { transform: translateX(-3px); }
    75% { transform: translateX(3px); }
  }

  .play-view {
    min-height: 280px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .result-view {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 280px;
    padding: 24px;
  }
  .result-icon { font-size: 3rem; margin-bottom: 8px; }
  .result-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--color-text-muted);
    margin-bottom: 12px;
  }

  @media (max-width: 640px) {
    .chimp-grid { gap: 3px; padding: 8px; }
    :global(.chimp-cell) { font-size: 0.85rem; }
  }
</style>

<script>
  (function () {
    'use strict';

    const GRID_COLS = 8;
    const GRID_ROWS = 5;
    const TOTAL_CELLS = GRID_COLS * GRID_ROWS;
    const START_NUMBERS = 4;
    const MAX_STRIKES = 3;

    const RATING_SCALE = [
      { min: 11, label: 'Chimpanzee Level!', color: '#16a34a' },
      { min: 9, label: 'Great!', color: '#22c55e' },
      { min: 7, label: 'Good', color: '#2563eb' },
      { min: 5, label: 'Average', color: '#f59e0b' },
      { min: 0, label: 'Below Average', color: '#ef4444' },
    ];

    function getLocalRating(score: number) {
      for (const level of RATING_SCALE) {
        if (score >= level.min) return { label: level.label, color: level.color };
      }
      return { label: 'Below Average', color: '#ef4444' };
    }

    const STORAGE_KEY = 'toolcalcs_chimp-test_history';
    const MAX_HISTORY = 20;

    function loadHistory(): Array<{ score: number; date: string; rating: string }> {
      try { const r = localStorage.getItem(STORAGE_KEY); if (r) return JSON.parse(r); } catch {}
      return [];
    }
    function saveHistory(h: Array<{ score: number; date: string; rating: string }>) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(h.slice(0, MAX_HISTORY))); } catch {}
    }
    function addToHistory(score: number) {
      const h = loadHistory();
      h.unshift({ score, date: new Date().toISOString(), rating: getLocalRating(score).label });
      saveHistory(h);
    }

    // DOM
    const instructionsView = document.getElementById('instructionsView')!;
    const playView = document.getElementById('playView')!;
    const resultView = document.getElementById('resultView')!;
    const startBtn = document.getElementById('startBtn')!;
    const tryAgainBtn = document.getElementById('tryAgainBtn')!;
    const levelInfo = document.getElementById('levelInfo')!;
    const livesInfo = document.getElementById('livesInfo')!;
    const chimpGrid = document.getElementById('chimpGrid')!;
    const finalScore = document.getElementById('finalScore')!;
    const ratingBadge = document.getElementById('ratingBadge')!;
    const attemptHistorySection = document.getElementById('attemptHistory')!;
    const historyList = document.getElementById('historyList')!;

    let currentNumbers = START_NUMBERS;
    let strikes = 0;
    let highestCompleted = 0;
    let isPlaying = false;
    let numbersHidden = false;
    let nextExpected = 1;
    // Map: cellIndex -> number
    let numberMap = new Map<number, number>();
    let canClick = false;

    function showView(view: HTMLElement) {
      [instructionsView, playView, resultView].forEach(v => v.style.display = 'none');
      view.style.display = '';
    }

    function shufflePositions(count: number): number[] {
      const all = Array.from({ length: TOTAL_CELLS }, (_, i) => i);
      for (let i = all.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [all[i], all[j]] = [all[j], all[i]];
      }
      return all.slice(0, count);
    }

    function renderGrid() {
      chimpGrid.innerHTML = '';
      for (let i = 0; i < TOTAL_CELLS; i++) {
        const btn = document.createElement('button');
        btn.className = 'chimp-cell';
        btn.dataset.index = String(i);
        if (numberMap.has(i)) {
          btn.className = 'chimp-cell has-number';
          btn.textContent = String(numberMap.get(i));
        }
        chimpGrid.appendChild(btn);
      }
    }

    function hideNumbers() {
      numbersHidden = true;
      chimpGrid.querySelectorAll('.chimp-cell.has-number').forEach(cell => {
        cell.classList.add('hidden-num');
      });
    }

    function startRound() {
      nextExpected = 1;
      numbersHidden = false;
      canClick = true;

      // Place numbers on random cells
      const positions = shufflePositions(currentNumbers);
      numberMap = new Map();
      for (let i = 0; i < currentNumbers; i++) {
        numberMap.set(positions[i], i + 1);
      }

      levelInfo.textContent = `Numbers: ${currentNumbers}`;
      livesInfo.textContent = `‚ùå ${strikes} / ${MAX_STRIKES}`;

      renderGrid();
    }

    function handleCellClick(e: Event) {
      if (!isPlaying || !canClick) return;
      const target = (e.target as HTMLElement).closest('.chimp-cell') as HTMLElement | null;
      if (!target) return;
      const idx = parseInt(target.dataset.index || '-1');
      if (idx < 0) return;

      // Ignore clicks on cells without numbers or already cleared
      if (!numberMap.has(idx)) return;
      if (target.classList.contains('correct-cell')) return;

      const num = numberMap.get(idx)!;

      if (num === nextExpected) {
        // Correct - first click hides all numbers
        if (nextExpected === 1 && !numbersHidden) {
          hideNumbers();
        }

        target.classList.remove('hidden-num');
        target.classList.add('correct-cell');
        target.textContent = String(num);
        nextExpected++;

        if (nextExpected > currentNumbers) {
          // Level complete
          canClick = false;
          highestCompleted = currentNumbers;
          currentNumbers++;
          setTimeout(() => startRound(), 500);
        }
      } else {
        // Wrong
        target.classList.add('wrong-cell');
        target.textContent = String(numberMap.get(idx));
        canClick = false;
        strikes++;
        livesInfo.textContent = `‚ùå ${strikes} / ${MAX_STRIKES}`;

        // Reveal all numbers briefly
        chimpGrid.querySelectorAll('.chimp-cell.has-number').forEach(cell => {
          const ci = parseInt((cell as HTMLElement).dataset.index || '-1');
          if (numberMap.has(ci)) {
            cell.classList.remove('hidden-num');
            cell.textContent = String(numberMap.get(ci));
          }
        });

        if (strikes >= MAX_STRIKES) {
          setTimeout(() => endGame(), 800);
        } else {
          // Retry same level
          setTimeout(() => startRound(), 1000);
        }
      }
    }

    function startGame() {
      currentNumbers = START_NUMBERS;
      strikes = 0;
      highestCompleted = 0;
      isPlaying = true;
      showView(playView);
      startRound();
    }

    function endGame() {
      isPlaying = false;
      const score = highestCompleted;
      showView(resultView);
      finalScore.textContent = String(score);
      const rating = getLocalRating(score);
      ratingBadge.textContent = rating.label;
      ratingBadge.style.background = rating.color;
      addToHistory(score);
      renderHistory();
    }

    function renderHistory() {
      const history = loadHistory();
      if (history.length === 0) { attemptHistorySection.hidden = true; return; }
      attemptHistorySection.hidden = false;
      historyList.innerHTML = history.map(e => {
        const r = getLocalRating(e.score);
        return `<div class="history-item">
          <span class="history-score">${e.score} numbers</span>
          <span class="history-rating" style="background:${r.color}">${r.label}</span>
          <span class="history-time">${formatDate(e.date)}</span>
        </div>`;
      }).join('');
    }

    function formatDate(iso: string): string {
      try { return new Date(iso).toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }); }
      catch { return ''; }
    }

    chimpGrid.addEventListener('click', handleCellClick);
    startBtn.addEventListener('click', startGame);
    tryAgainBtn.addEventListener('click', startGame);
    renderHistory();
  })();
</script>
