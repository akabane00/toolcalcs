---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdUnit from '../../components/AdUnit.astro';
import { getGameBySlug } from '../../data/games';
import '../../styles/game.css';
import GameShare from '../../components/GameShare.astro';

const game = getGameBySlug('math-flashcards')!;

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://toolcalcs.com/" },
      { "@type": "ListItem", "position": 2, "name": "Tests & Games", "item": "https://toolcalcs.com/test/" },
      { "@type": "ListItem", "position": 3, "name": "Math Flashcards" }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Math Flashcards",
    "url": "https://toolcalcs.com/test/math-flashcards/",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "All",
    "browserRequirements": "Requires JavaScript",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "description": game.description
  }
];
---

<BaseLayout
  title="Math Flashcards - Timed Mental Math Practice | ToolCalcs"
  description="Free online math flashcards with timer. Practice addition, subtraction, multiplication, and division. Track your score and improve your mental math speed."
  type="article"
  structuredData={structuredData}
>
  <nav class="breadcrumb">
    <a href="/">Home</a> &rsaquo;
    <a href="/test/">Tests & Games</a> &rsaquo;
    <span>Math Flashcards</span>
  </nav>

  <h1>Math Flashcards</h1>
  <p class="page-desc">{game.description}</p>

  <div class="game-box">
    <!-- Setup Panel -->
    <div class="fc-setup" id="fcSetup">
      <div class="fc-setup-icon" aria-hidden="true">ðŸ”¢</div>
      <h2>Math Flashcards</h2>
      <p>Answer as many problems as you can before time runs out!</p>
      <div class="fc-settings">
        <div class="fc-setting">
          <label for="cfgOperation">Operation</label>
          <select id="cfgOperation">
            <option value="addition">Addition</option>
            <option value="subtraction">Subtraction</option>
            <option value="multiplication">Multiplication</option>
            <option value="division">Division</option>
            <option value="mixed" selected>Mixed</option>
          </select>
        </div>
        <div class="fc-setting">
          <label for="cfgDifficulty">Difficulty</label>
          <select id="cfgDifficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div class="fc-setting">
          <label for="cfgDuration">Duration</label>
          <select id="cfgDuration">
            <option value="30">30 seconds</option>
            <option value="60" selected>60 seconds</option>
            <option value="120">2 minutes</option>
          </select>
        </div>
      </div>
      <button class="game-btn primary" id="btnStart" type="button">Start</button>
    </div>

    <!-- Playing Area -->
    <div class="fc-playing" id="fcPlaying" style="display:none;">
      <div class="fc-timer-bar">
        <div class="fc-timer-fill" id="fcTimerFill"></div>
      </div>
      <div class="fc-stats-row">
        <span class="fc-stat"><strong id="fcCorrect">0</strong> correct</span>
        <span class="fc-stat"><strong id="fcTotal">0</strong> total</span>
        <span class="fc-stat fc-streak-stat" aria-label="Streak">&#128293; <strong id="fcStreak">0</strong></span>
        <span class="fc-stat fc-time" id="fcTimeLeft">60s</span>
      </div>
      <div class="fc-card" id="fcCard">
        <div class="fc-problem" id="fcProblem"></div>
        <div class="fc-feedback" id="fcFeedback"></div>
      </div>
      <div class="fc-input-row">
        <input type="number" id="fcAnswer" class="fc-input" placeholder="?" autocomplete="off" inputmode="numeric" />
        <button class="game-btn primary fc-submit" id="btnSubmit" type="button">&rarr;</button>
      </div>
    </div>

    <!-- Result -->
    <div class="score-display" id="fcResult" style="display:none;">
      <span class="score-value" id="fcScoreValue"></span>
      <span class="score-unit">Correct Answers</span>
      <div class="rating-badge" id="fcRating"></div>
      <div class="fc-result-stats" id="fcResultStats"></div>
    </div>

    <div class="game-controls" id="fcControls" style="display:none;">
      <button class="game-btn primary" id="btnRetry" type="button">Try Again</button>
    </div>

    <GameShare />

    <div class="attempt-history" id="fcHistory" hidden>
      <h3>Recent Attempts</h3>
      <div class="history-list" id="fcHistoryList"></div>
    </div>
  </div>

  <AdUnit slot="game-mid" format="horizontal" />

  <article class="content-section">
    <h2>What Are Math Flashcards?</h2>
    <p>Math flashcards are one of the most effective tools for building arithmetic fluency. Traditional flashcards use physical cards with a problem on one side and the answer on the other. This digital version takes the concept further by adding a timer, instant feedback, and automatic score tracking. Instead of flipping cards manually, problems appear on screen and you type your answer as quickly as you can.</p>
    <p>The timed format transforms simple practice into an engaging challenge. With a countdown running, every second counts. This urgency activates your brain differently than untimed practice, building the quick recall pathways that make mental math feel automatic. Research consistently shows that timed retrieval practice is one of the most effective ways to commit math facts to long-term memory.</p>

    <h2>How Flashcard Practice Works</h2>
    <p>Select your preferred operation (addition, subtraction, multiplication, division, or mixed), difficulty level, and timer duration. Click Start and problems will appear one at a time on the flashcard. Type your answer and press Enter to submit. Correct answers flash green and advance immediately. Wrong answers flash red, briefly show the correct answer, and then move on. Your goal is to answer as many problems correctly as possible before time runs out.</p>
    <p>The difficulty setting adjusts the number ranges used in problems. Easy mode uses small numbers suitable for beginners (single digits for most operations). Medium mode increases the range to challenge students who have mastered basic facts. Hard mode uses larger numbers that require genuine mental calculation rather than simple fact recall.</p>

    <h2>Benefits of Timed Flashcard Practice</h2>
    <h3>Builds Automaticity</h3>
    <p>The primary goal of flashcard practice is automaticity: the ability to recall math facts instantly without conscious calculation. When a student sees 7 &times; 8 and immediately knows 56, that is automaticity. This frees up working memory for more complex problem solving. Students who have automatic recall of basic facts perform significantly better on multi-step problems, algebra, and standardized tests.</p>

    <h3>Immediate Feedback Loop</h3>
    <p>Unlike traditional worksheets where you check answers after completing the entire page, flashcards provide instant feedback on every problem. This immediate reinforcement strengthens correct associations and quickly corrects errors before they become habits. The green and red visual feedback creates a clear reward signal that motivates continued practice.</p>

    <h3>Tracks Progress Over Time</h3>
    <p>Every attempt is saved in your browser's local storage, creating a personal progress log. You can see your scores improve over time, which provides motivation and helps identify when you are ready to increase the difficulty. Setting personal records adds a competitive element that keeps practice engaging.</p>

    <h2>Difficulty Guide</h2>
    <h3>Easy (Ages 5-8)</h3>
    <p>Easy mode uses numbers appropriate for kindergarten through second grade. Addition and subtraction use numbers up to 10. Multiplication and division use factors up to 5. This level focuses on building confidence and establishing basic fact recall. Start here if you are just beginning to learn your math facts.</p>

    <h3>Medium (Ages 8-11)</h3>
    <p>Medium mode challenges students in grades three through five. Addition and subtraction range up to 50. Multiplication covers the standard times tables (up to 12 &times; 12). Division uses clean results within the times table range. Most students should aim to become fluent at this level before moving to hard.</p>

    <h3>Hard (Ages 11+)</h3>
    <p>Hard mode is designed for advanced students and adults looking to sharpen their mental math. Addition and subtraction use numbers up to 100. Multiplication includes two-digit by one-digit problems. Division includes larger dividends. This level builds genuine mental calculation skills beyond simple fact recall.</p>

    <h2>Tips for Better Scores</h2>
    <ul>
      <li><strong>Start with one operation.</strong> Master addition facts before mixing in subtraction. Build multiplication fluency before adding division. Mixed mode is the ultimate challenge after you are comfortable with individual operations.</li>
      <li><strong>Practice in short sessions.</strong> Three 60-second rounds are more effective than one long session. Short bursts maintain focus and prevent fatigue.</li>
      <li><strong>Use the streak counter.</strong> Try to beat your longest streak of consecutive correct answers. Streaks encourage accuracy alongside speed.</li>
      <li><strong>Review your mistakes.</strong> When you see the correct answer flash after an error, take a mental note. These are the facts you need to practice most.</li>
      <li><strong>Increase difficulty gradually.</strong> Move to the next level only when you consistently score in the "Good" or "Great" range at your current level.</li>
      <li><strong>Practice daily.</strong> Consistent short practice sessions build stronger neural pathways than occasional long sessions. Even two minutes per day makes a measurable difference over a month.</li>
    </ul>

    <h2>How Scores Are Rated</h2>
    <p>Your score is the total number of correct answers within the time limit. The rating system provides a quick assessment of your performance:</p>
    <ul>
      <li><strong>Keep Practicing (0-5):</strong> You are building your foundation. Focus on accuracy over speed.</li>
      <li><strong>Getting There (6-10):</strong> You know some facts but need more practice for fluency.</li>
      <li><strong>Good (11-20):</strong> Solid performance. You are answering about one problem every 3-5 seconds.</li>
      <li><strong>Great (21-30):</strong> Strong mental math skills. You are recalling facts quickly and accurately.</li>
      <li><strong>Math Whiz (31+):</strong> Exceptional speed and accuracy. You have achieved true automaticity.</li>
    </ul>

    <h2>Related Tests</h2>
    <ul>
      <li><a href="/test/timed-math-drills/">Timed Math Drills</a> - Solve problems in a scrolling list format for a different challenge.</li>
      <li><a href="/test/number-memory-test/">Number Memory Test</a> - Test your short-term memory with number sequences.</li>
      <li><a href="/test/reaction-time-test/">Reaction Time Test</a> - Measure how fast you can react to visual stimuli.</li>
      <li><a href="/worksheets/multiplication-worksheets/">Multiplication Worksheets</a> - Printable times tables practice.</li>
    </ul>
  </article>

  <AdUnit slot="game-bottom" format="horizontal" />
</BaseLayout>

<style>
  .fc-setup {
    text-align: center;
    padding: 32px 20px;
  }
  .fc-setup-icon {
    font-size: 3rem;
    margin-bottom: 8px;
  }
  .fc-setup h2 {
    font-size: 1.4rem;
    margin-bottom: 6px;
  }
  .fc-setup p {
    color: var(--color-text-muted);
    margin-bottom: 20px;
  }
  .fc-settings {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .fc-setting {
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-align: left;
  }
  .fc-setting label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .fc-setting select {
    padding: 8px 12px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    background: var(--color-bg);
    font-size: 0.9rem;
    min-width: 140px;
  }

  .fc-playing {
    padding: 0 20px 20px;
  }
  .fc-timer-bar {
    height: 6px;
    background: var(--color-bg);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 12px;
  }
  .fc-timer-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 3px;
    width: 100%;
    transition: width 0.1s linear, background 0.3s;
  }
  .fc-timer-fill.warning { background: #f59e0b; }
  .fc-timer-fill.danger { background: #ef4444; }

  .fc-stats-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 16px;
    font-size: 0.85rem;
    color: var(--color-text-muted);
  }
  .fc-stat strong {
    color: var(--color-text);
    font-size: 1rem;
  }
  .fc-streak-stat strong {
    color: #f59e0b;
  }
  .fc-time {
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }

  .fc-card {
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: var(--radius);
    min-height: 180px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s, background 0.2s;
  }
  .fc-card.correct {
    border-color: #22c55e;
    background: #f0fdf4;
  }
  .fc-card.wrong {
    border-color: #ef4444;
    background: #fef2f2;
  }
  .fc-problem {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--color-text);
    letter-spacing: 2px;
    user-select: none;
  }
  .fc-feedback {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 8px;
    min-height: 24px;
  }
  .fc-feedback.correct-text { color: #16a34a; }
  .fc-feedback.wrong-text { color: #ef4444; }

  .fc-input-row {
    display: flex;
    justify-content: center;
    gap: 8px;
  }
  .fc-input {
    width: 120px;
    padding: 12px 16px;
    border: 2px solid var(--color-border);
    border-radius: var(--radius);
    font-size: 1.4rem;
    font-weight: 700;
    text-align: center;
    outline: none;
    transition: border-color 0.15s;
  }
  .fc-input:focus {
    border-color: var(--color-primary);
  }
  .fc-submit {
    padding: 12px 20px;
    font-size: 1.2rem;
  }

  .fc-result-stats {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-top: 16px;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }
  .fc-result-stats span {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }
  .fc-result-stats strong {
    font-size: 1.1rem;
    color: var(--color-text);
  }

  @media (max-width: 640px) {
    .fc-problem { font-size: 2rem; }
    .fc-card { min-height: 140px; }
    .fc-settings { flex-direction: column; align-items: center; }
    .fc-result-stats { gap: 16px; font-size: 0.8rem; }
  }

  @media (prefers-color-scheme: dark) {
    .fc-card.correct { background: rgba(34, 197, 94, 0.1); }
    .fc-card.wrong { background: rgba(239, 68, 68, 0.1); }
  }
</style>

<script define:vars={{ gameName: game.title, gameSlug: game.slug, gameIcon: game.icon, metricLabel: game.metricLabel, metricUnit: game.metricUnit }}>
  window.__gameShareVars = { gameName, gameSlug, gameIcon, metricLabel, metricUnit };
</script>

<script>
  (function () {
    'use strict';

    var STORAGE_KEY = 'toolcalcs_math-flashcards_history';
    var MAX_HISTORY = 20;

    var ratingScale = [
      { min: 31, label: 'Math Whiz!', color: '#16a34a' },
      { min: 21, label: 'Great!', color: '#22c55e' },
      { min: 11, label: 'Good', color: '#2563eb' },
      { min: 6, label: 'Getting There', color: '#f59e0b' },
      { min: 0, label: 'Keep Practicing', color: '#ef4444' },
    ];

    var setupPanel = document.getElementById('fcSetup');
    var playingPanel = document.getElementById('fcPlaying');
    var resultPanel = document.getElementById('fcResult');
    var controlsPanel = document.getElementById('fcControls');
    var historySection = document.getElementById('fcHistory');
    var historyListEl = document.getElementById('fcHistoryList');

    var cfgOperation = document.getElementById('cfgOperation');
    var cfgDifficulty = document.getElementById('cfgDifficulty');
    var cfgDuration = document.getElementById('cfgDuration');

    var timerFill = document.getElementById('fcTimerFill');
    var correctEl = document.getElementById('fcCorrect');
    var totalEl = document.getElementById('fcTotal');
    var streakEl = document.getElementById('fcStreak');
    var timeLeftEl = document.getElementById('fcTimeLeft');
    var cardEl = document.getElementById('fcCard');
    var problemEl = document.getElementById('fcProblem');
    var feedbackEl = document.getElementById('fcFeedback');
    var answerInput = document.getElementById('fcAnswer');
    var btnSubmit = document.getElementById('btnSubmit');
    var btnStart = document.getElementById('btnStart');
    var btnRetry = document.getElementById('btnRetry');
    var scoreValueEl = document.getElementById('fcScoreValue');
    var ratingBadgeEl = document.getElementById('fcRating');
    var resultStatsEl = document.getElementById('fcResultStats');

    var state = 'setup';
    var duration = 60;
    var correct = 0;
    var total = 0;
    var streak = 0;
    var maxStreak = 0;
    var startTime = 0;
    var currentAnswer = 0;
    var timerInterval = null;
    var responseTimes = [];
    var lastProblemTime = 0;
    var feedbackTimeout = null;

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateProblem(operation, difficulty) {
      var ops = operation === 'mixed'
        ? ['addition', 'subtraction', 'multiplication', 'division']
        : [operation];
      var op = ops[randInt(0, ops.length - 1)];
      var a, b, answer, text;

      if (op === 'addition') {
        var mx = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 50 : 100;
        a = randInt(1, mx);
        b = randInt(1, mx);
        text = a + ' + ' + b;
        answer = a + b;
      } else if (op === 'subtraction') {
        var mx = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 50 : 100;
        a = randInt(1, mx);
        b = randInt(1, a);
        text = a + ' \u2212 ' + b;
        answer = a - b;
      } else if (op === 'multiplication') {
        var mxA = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 15;
        var mxB = difficulty === 'easy' ? 5 : 12;
        a = randInt(2, mxA);
        b = randInt(2, mxB);
        text = a + ' \u00d7 ' + b;
        answer = a * b;
      } else {
        var maxDiv = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 15;
        b = randInt(2, maxDiv);
        answer = randInt(2, difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 20);
        a = b * answer;
        text = a + ' \u00f7 ' + b;
      }

      return { text: text + ' = ?', answer: answer };
    }

    function getRating(score) {
      for (var i = 0; i < ratingScale.length; i++) {
        if (score >= ratingScale[i].min) return ratingScale[i];
      }
      return ratingScale[ratingScale.length - 1];
    }

    function showSetup() {
      state = 'setup';
      setupPanel.style.display = '';
      playingPanel.style.display = 'none';
      resultPanel.style.display = 'none';
      controlsPanel.style.display = 'none';
      if (window.GameShare) window.GameShare.hide();
    }

    function startGame() {
      state = 'playing';
      duration = parseInt(cfgDuration.value, 10);
      correct = 0;
      total = 0;
      streak = 0;
      maxStreak = 0;
      responseTimes = [];
      startTime = Date.now();
      lastProblemTime = Date.now();

      setupPanel.style.display = 'none';
      playingPanel.style.display = '';
      resultPanel.style.display = 'none';
      controlsPanel.style.display = 'none';
      if (window.GameShare) window.GameShare.hide();

      correctEl.textContent = '0';
      totalEl.textContent = '0';
      streakEl.textContent = '0';
      timeLeftEl.textContent = duration + 's';
      timerFill.style.width = '100%';
      timerFill.classList.remove('warning', 'danger');

      showNextProblem();
      answerInput.focus();
      timerInterval = setInterval(updateTimer, 50);
    }

    function showNextProblem() {
      if (feedbackTimeout) clearTimeout(feedbackTimeout);
      var problem = generateProblem(cfgOperation.value, cfgDifficulty.value);
      currentAnswer = problem.answer;
      problemEl.textContent = problem.text;
      answerInput.value = '';
      cardEl.classList.remove('correct', 'wrong');
      feedbackEl.textContent = '';
      feedbackEl.className = 'fc-feedback';
      lastProblemTime = Date.now();
      answerInput.focus();
    }

    function submitAnswer() {
      if (state !== 'playing') return;
      var userAnswer = parseInt(answerInput.value, 10);
      if (isNaN(userAnswer)) return;

      var responseTime = Date.now() - lastProblemTime;
      responseTimes.push(responseTime);
      total++;
      totalEl.textContent = String(total);

      if (userAnswer === currentAnswer) {
        correct++;
        streak++;
        if (streak > maxStreak) maxStreak = streak;
        correctEl.textContent = String(correct);
        streakEl.textContent = String(streak);
        cardEl.classList.add('correct');
        feedbackEl.textContent = 'Correct!';
        feedbackEl.className = 'fc-feedback correct-text';
        feedbackTimeout = setTimeout(showNextProblem, 300);
      } else {
        streak = 0;
        streakEl.textContent = '0';
        cardEl.classList.add('wrong');
        feedbackEl.textContent = 'Answer: ' + currentAnswer;
        feedbackEl.className = 'fc-feedback wrong-text';
        feedbackTimeout = setTimeout(showNextProblem, 1200);
      }
    }

    function updateTimer() {
      var elapsed = (Date.now() - startTime) / 1000;
      var remaining = Math.max(0, duration - elapsed);
      var pct = (remaining / duration) * 100;
      timeLeftEl.textContent = Math.ceil(remaining) + 's';
      timerFill.style.width = pct + '%';

      if (pct <= 20) {
        timerFill.classList.add('danger');
        timerFill.classList.remove('warning');
      } else if (pct <= 40) {
        timerFill.classList.add('warning');
        timerFill.classList.remove('danger');
      }

      if (remaining <= 0) endGame();
    }

    function endGame() {
      state = 'result';
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      if (feedbackTimeout) { clearTimeout(feedbackTimeout); feedbackTimeout = null; }

      var rating = getRating(correct);
      var accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
      var avgTime = responseTimes.length > 0
        ? Math.round(responseTimes.reduce(function (a, b) { return a + b; }, 0) / responseTimes.length)
        : 0;

      playingPanel.style.display = 'none';
      resultPanel.style.display = '';
      controlsPanel.style.display = '';

      scoreValueEl.textContent = String(correct);
      ratingBadgeEl.textContent = rating.label;
      ratingBadgeEl.style.background = rating.color;

      resultStatsEl.innerHTML =
        '<span><strong>' + total + '</strong>attempted</span>' +
        '<span><strong>' + accuracy + '%</strong>accuracy</span>' +
        '<span><strong>' + (avgTime / 1000).toFixed(1) + 's</strong>avg time</span>' +
        '<span><strong>' + maxStreak + '</strong>best streak</span>';

      saveAttempt(correct, rating.label);
      renderHistory();

      if (window.GameShare) {
        var gsv = window.__gameShareVars;
        window.GameShare.show({
          gameName: gsv.gameName,
          gameSlug: gsv.gameSlug,
          gameIcon: gsv.gameIcon,
          score: correct,
          unit: gsv.metricUnit,
          metricLabel: gsv.metricLabel,
          ratingLabel: rating.label,
          ratingColor: rating.color
        });
      }
    }

    btnStart.addEventListener('click', startGame);
    btnRetry.addEventListener('click', showSetup);
    btnSubmit.addEventListener('click', submitAnswer);
    answerInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') { e.preventDefault(); submitAnswer(); }
    });

    function loadHistory() {
      try {
        var raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) { return []; }
    }

    function saveAttempt(score, rating) {
      var history = loadHistory();
      history.unshift({ score: score, rating: rating, timestamp: Date.now() });
      if (history.length > MAX_HISTORY) history.length = MAX_HISTORY;
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(history)); } catch (e) {}
    }

    function renderHistory() {
      var history = loadHistory();
      if (history.length === 0) { historySection.hidden = true; return; }
      historySection.hidden = false;
      historyListEl.innerHTML = '';
      for (var i = 0; i < history.length; i++) {
        var entry = history[i];
        var r = getRating(entry.score);
        var item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML =
          '<span class="history-score">' + entry.score + ' correct</span>' +
          '<span class="history-rating" style="background:' + r.color + '">' + entry.rating + '</span>' +
          '<span class="history-time">' + formatTimeAgo(entry.timestamp) + '</span>';
        historyListEl.appendChild(item);
      }
    }

    function formatTimeAgo(timestamp) {
      var diff = Date.now() - timestamp;
      var seconds = Math.floor(diff / 1000);
      if (seconds < 60) return 'just now';
      var minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + 'm ago';
      var hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + 'h ago';
      return Math.floor(hours / 24) + 'd ago';
    }

    renderHistory();
  })();
</script>
