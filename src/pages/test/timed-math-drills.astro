---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdUnit from '../../components/AdUnit.astro';
import { getGameBySlug } from '../../data/games';
import '../../styles/game.css';
import GameShare from '../../components/GameShare.astro';

const game = getGameBySlug('timed-math-drills')!;

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://toolcalcs.com/" },
      { "@type": "ListItem", "position": 2, "name": "Tests & Games", "item": "https://toolcalcs.com/test/" },
      { "@type": "ListItem", "position": 3, "name": "Timed Math Drills" }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Timed Math Drills",
    "url": "https://toolcalcs.com/test/timed-math-drills/",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "All",
    "browserRequirements": "Requires JavaScript",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "description": game.description
  }
];
---

<BaseLayout
  title="Timed Math Drills - Speed Mental Math Practice | ToolCalcs"
  description="Free timed math drills online. Race against the clock solving addition, subtraction, multiplication, and division problems. Track your speed and accuracy."
  type="article"
  structuredData={structuredData}
>
  <nav class="breadcrumb">
    <a href="/">Home</a> &rsaquo;
    <a href="/test/">Tests & Games</a> &rsaquo;
    <span>Timed Math Drills</span>
  </nav>

  <h1>Timed Math Drills</h1>
  <p class="page-desc">{game.description}</p>

  <div class="game-box">
    <!-- Setup -->
    <div class="drill-setup" id="drillSetup">
      <div class="drill-setup-icon" aria-hidden="true">&#9201;&#65039;</div>
      <h2>Timed Math Drills</h2>
      <p>Solve as many problems as you can before time runs out!</p>
      <div class="drill-settings">
        <div class="drill-setting">
          <label for="cfgOperation">Operation</label>
          <select id="cfgOperation">
            <option value="addition">Addition</option>
            <option value="subtraction">Subtraction</option>
            <option value="multiplication">Multiplication</option>
            <option value="division">Division</option>
            <option value="mixed" selected>Mixed</option>
          </select>
        </div>
        <div class="drill-setting">
          <label for="cfgDifficulty">Difficulty</label>
          <select id="cfgDifficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div class="drill-setting">
          <label for="cfgDuration">Duration</label>
          <select id="cfgDuration">
            <option value="30">30 seconds</option>
            <option value="60" selected>60 seconds</option>
            <option value="120">2 minutes</option>
          </select>
        </div>
      </div>
      <button class="game-btn primary" id="btnStart" type="button">Start Drill</button>
    </div>

    <!-- Playing -->
    <div class="drill-playing" id="drillPlaying" style="display:none;">
      <div class="drill-header">
        <div class="drill-timer-bar">
          <div class="drill-timer-fill" id="drillTimerFill"></div>
        </div>
        <div class="drill-header-stats">
          <span class="drill-hstat"><span class="drill-check-icon">&check;</span> <strong id="drillCorrect">0</strong></span>
          <span class="drill-hstat"><span class="drill-x-icon">&cross;</span> <strong id="drillWrong">0</strong></span>
          <span class="drill-hstat drill-clock" id="drillTimeLeft">60s</span>
        </div>
      </div>
      <div class="drill-list" id="drillList"></div>
      <div class="drill-current" id="drillCurrent">
        <span class="drill-num" id="drillNum">1)</span>
        <span class="drill-problem" id="drillProblem"></span>
        <input type="number" id="drillAnswer" class="drill-input" placeholder="?" autocomplete="off" inputmode="numeric" />
      </div>
    </div>

    <!-- Result -->
    <div class="score-display" id="drillResult" style="display:none;">
      <span class="score-value" id="drillScoreValue"></span>
      <span class="score-unit">Problems Solved</span>
      <div class="rating-badge" id="drillRating"></div>
      <div class="drill-result-stats" id="drillResultStats"></div>
    </div>

    <div class="game-controls" id="drillControls" style="display:none;">
      <button class="game-btn primary" id="btnRetry" type="button">Try Again</button>
    </div>

    <GameShare />

    <div class="attempt-history" id="drillHistory" hidden>
      <h3>Recent Attempts</h3>
      <div class="history-list" id="drillHistoryList"></div>
    </div>
  </div>

  <AdUnit slot="game-mid" format="horizontal" />

  <article class="content-section">
    <h2>What Are Timed Math Drills?</h2>
    <p>Timed math drills are a structured speed practice format where you solve a continuous stream of arithmetic problems against a countdown timer. Unlike flashcards that show one problem at a time with a card-flip feel, drills present problems in a scrolling list that builds as you answer. Each completed problem remains visible above, creating a visual record of your progress and encouraging you to keep the momentum going.</p>
    <p>This format mimics the traditional classroom "mad minute" exercise that has been a staple of math education for decades. The combination of time pressure and visible progress creates a focused, productive practice environment. Students can see exactly how many problems they have solved, which answered problems were correct or incorrect, and how much time remains.</p>

    <h2>How the Drill Works</h2>
    <p>Choose your operation, difficulty, and duration, then click Start Drill. Problems appear one at a time at the bottom of the screen. Type your answer and press Enter to submit. Correct answers are marked with a green checkmark and the next problem appears immediately. Wrong answers show a red X with the correct answer, then move on. All completed problems scroll up into a visible list above.</p>
    <p>Your score is the number of correct answers. The goal is to maximize correct answers within the time limit. Speed matters, but accuracy matters more. A wrong answer wastes the time spent on it without adding to your score, so it is better to take an extra half-second to be sure than to rush and make errors.</p>

    <h2>Drills vs. Flashcards</h2>
    <p>Both drills and flashcards build math fact fluency, but they offer different experiences. Flashcards emphasize one problem at a time with animated feedback, creating a game-like feel with streak counters and visual rewards. Drills emphasize volume and momentum, with the growing list of completed problems providing its own motivation. Many students benefit from using both formats: flashcards for focused practice on specific operations, and drills for building speed and stamina across mixed problems.</p>

    <h2>Why Speed Practice Matters</h2>
    <h3>Cognitive Fluency</h3>
    <p>When basic math facts can be recalled instantly, students can devote their full attention to higher-level thinking in complex problems. A student solving a multi-step word problem should not be pausing to calculate 8 &times; 7. That fact should come automatically. Timed drills build this automaticity by training the brain to retrieve answers without conscious calculation.</p>

    <h3>Test Preparation</h3>
    <p>Standardized tests and classroom exams are timed. Students who can work through arithmetic quickly have more time to spend on challenging questions, review their work, and manage test anxiety. Regular drill practice builds both the speed and the confidence needed for timed testing situations.</p>

    <h3>Real-World Math</h3>
    <p>Mental math speed is practical in everyday life. Calculating tips, splitting bills, estimating prices while shopping, adjusting recipe quantities, and countless other daily tasks become easier when arithmetic is automatic. Drill practice makes these real-world calculations feel effortless.</p>

    <h2>Difficulty Levels</h2>
    <h3>Easy</h3>
    <p>Small numbers suitable for early learners. Addition and subtraction use numbers up to 10. Multiplication and division use factors up to 5. This level builds confidence and is appropriate for students in grades 1-3 who are still learning their basic facts.</p>

    <h3>Medium</h3>
    <p>Standard difficulty covering the core facts. Addition and subtraction range up to 50. Multiplication covers the full times tables through 12. Division uses clean results within the times table range. This is the most commonly used level and aligns with grade 3-6 curriculum standards.</p>

    <h3>Hard</h3>
    <p>Challenging problems for advanced students. Addition and subtraction use numbers up to 100. Multiplication includes larger factors. Division uses bigger dividends. This level builds genuine mental calculation skills and is appropriate for students in grade 5 and above, as well as adults looking to sharpen their arithmetic.</p>

    <h2>Tips for Higher Scores</h2>
    <ul>
      <li><strong>Focus on accuracy first.</strong> A wrong answer takes time and gives zero points. Build accuracy at lower difficulty before pushing for speed.</li>
      <li><strong>Learn to type numbers quickly.</strong> Your typing speed directly affects your drill score. Practice entering answers with the number keys or numpad.</li>
      <li><strong>Memorize, don't calculate.</strong> For basic facts (especially multiplication tables), the goal is instant recall rather than mental calculation. If you find yourself counting up, you need more memorization practice.</li>
      <li><strong>Start with single operations.</strong> Master one operation type before trying mixed mode. Mixed drills require rapid context-switching between operations, which is a separate skill.</li>
      <li><strong>Use the 30-second option for warm-ups.</strong> A quick 30-second round gets your brain engaged before doing longer sessions.</li>
      <li><strong>Review your completed list.</strong> After each drill, look at which problems got red X marks. These are the facts you need to study more.</li>
    </ul>

    <h2>Score Ratings</h2>
    <p>Your score is the number of correctly solved problems. Ratings are calibrated for the 60-second default duration:</p>
    <ul>
      <li><strong>Warming Up (0-10):</strong> Building your foundation. Focus on accuracy and learning the facts.</li>
      <li><strong>Average (11-20):</strong> Solid pace of about one problem every 3-5 seconds.</li>
      <li><strong>Good (21-35):</strong> Quick recall with good accuracy. You are answering a problem every 2-3 seconds.</li>
      <li><strong>Fast (36-50):</strong> Impressive speed. You have strong fact fluency.</li>
      <li><strong>Speed Demon (51+):</strong> Exceptional. Nearly one problem per second with high accuracy.</li>
    </ul>

    <h2>Related Tests</h2>
    <ul>
      <li><a href="/test/math-flashcards/">Math Flashcards</a> - Practice with single-card format and streak tracking.</li>
      <li><a href="/test/reaction-time-test/">Reaction Time Test</a> - Test your visual reaction speed.</li>
      <li><a href="/test/typing-speed-test/">Typing Speed Test</a> - Measure your typing speed in words per minute.</li>
      <li><a href="/worksheets/addition-worksheets/">Addition Worksheets</a> - Printable addition fact practice.</li>
    </ul>
  </article>

  <AdUnit slot="game-bottom" format="horizontal" />
</BaseLayout>

<style>
  .drill-setup {
    text-align: center;
    padding: 32px 20px;
  }
  .drill-setup-icon {
    font-size: 3rem;
    margin-bottom: 8px;
  }
  .drill-setup h2 {
    font-size: 1.4rem;
    margin-bottom: 6px;
  }
  .drill-setup p {
    color: var(--color-text-muted);
    margin-bottom: 20px;
  }
  .drill-settings {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .drill-setting {
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-align: left;
  }
  .drill-setting label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .drill-setting select {
    padding: 8px 12px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    background: var(--color-bg);
    font-size: 0.9rem;
    min-width: 140px;
  }

  .drill-playing {
    padding: 0 20px 20px;
  }
  .drill-header {
    position: sticky;
    top: 0;
    background: var(--color-surface);
    z-index: 10;
    padding: 12px 0 8px;
  }
  .drill-timer-bar {
    height: 6px;
    background: var(--color-bg);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 8px;
  }
  .drill-timer-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 3px;
    width: 100%;
    transition: width 0.1s linear, background 0.3s;
  }
  .drill-timer-fill.warning { background: #f59e0b; }
  .drill-timer-fill.danger { background: #ef4444; }

  .drill-header-stats {
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 0.85rem;
    color: var(--color-text-muted);
  }
  .drill-hstat strong {
    color: var(--color-text);
    font-size: 1rem;
  }
  .drill-check-icon { color: #16a34a; font-weight: 700; }
  .drill-x-icon { color: #ef4444; font-weight: 700; }
  .drill-clock {
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }

  .drill-list {
    max-height: 280px;
    overflow-y: auto;
    margin-bottom: 12px;
  }
  :global(.drill-item) {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border-bottom: 1px solid var(--color-border);
    font-size: 0.95rem;
    font-family: 'Courier New', Courier, monospace;
  }
  :global(.drill-item .drill-mark) {
    font-size: 1rem;
    width: 20px;
    text-align: center;
    flex-shrink: 0;
  }
  :global(.drill-item .drill-mark.ok) { color: #16a34a; }
  :global(.drill-item .drill-mark.fail) { color: #ef4444; }
  :global(.drill-item .drill-q) {
    flex: 1;
    color: var(--color-text-muted);
  }
  :global(.drill-item .drill-a) {
    font-weight: 700;
  }
  :global(.drill-item .drill-a.ok) { color: #16a34a; }
  :global(.drill-item .drill-a.fail) { color: #ef4444; text-decoration: line-through; }
  :global(.drill-item .drill-correct-val) {
    color: #16a34a;
    font-weight: 700;
    margin-left: 4px;
  }

  .drill-current {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: var(--color-bg);
    border: 2px solid var(--color-primary);
    border-radius: var(--radius);
  }
  .drill-num {
    font-weight: 700;
    color: var(--color-text-muted);
    font-size: 0.9rem;
    min-width: 28px;
  }
  .drill-problem {
    font-size: 1.3rem;
    font-weight: 700;
    font-family: 'Courier New', Courier, monospace;
    flex: 1;
  }
  .drill-input {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid var(--color-border);
    border-radius: var(--radius);
    font-size: 1.2rem;
    font-weight: 700;
    text-align: center;
    outline: none;
  }
  .drill-input:focus {
    border-color: var(--color-primary);
  }

  .drill-result-stats {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-top: 16px;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }
  .drill-result-stats span {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }
  .drill-result-stats strong {
    font-size: 1.1rem;
    color: var(--color-text);
  }

  @media (max-width: 640px) {
    .drill-problem { font-size: 1.1rem; }
    .drill-settings { flex-direction: column; align-items: center; }
    .drill-result-stats { gap: 16px; font-size: 0.8rem; }
    .drill-list { max-height: 200px; }
  }
</style>

<script define:vars={{ gameName: game.title, gameSlug: game.slug, gameIcon: game.icon, metricLabel: game.metricLabel, metricUnit: game.metricUnit }}>
  window.__gameShareVars = { gameName, gameSlug, gameIcon, metricLabel, metricUnit };
</script>

<script>
  (function () {
    'use strict';

    var STORAGE_KEY = 'toolcalcs_timed-math-drills_history';
    var MAX_HISTORY = 20;

    var ratingScale = [
      { min: 51, label: 'Speed Demon!', color: '#16a34a' },
      { min: 36, label: 'Fast!', color: '#22c55e' },
      { min: 21, label: 'Good', color: '#2563eb' },
      { min: 11, label: 'Average', color: '#f59e0b' },
      { min: 0, label: 'Warming Up', color: '#ef4444' },
    ];

    var setupPanel = document.getElementById('drillSetup');
    var playingPanel = document.getElementById('drillPlaying');
    var resultPanel = document.getElementById('drillResult');
    var controlsPanel = document.getElementById('drillControls');
    var historySection = document.getElementById('drillHistory');
    var historyListEl = document.getElementById('drillHistoryList');

    var cfgOperation = document.getElementById('cfgOperation');
    var cfgDifficulty = document.getElementById('cfgDifficulty');
    var cfgDuration = document.getElementById('cfgDuration');

    var timerFill = document.getElementById('drillTimerFill');
    var correctEl = document.getElementById('drillCorrect');
    var wrongEl = document.getElementById('drillWrong');
    var timeLeftEl = document.getElementById('drillTimeLeft');
    var drillListEl = document.getElementById('drillList');
    var numEl = document.getElementById('drillNum');
    var problemEl = document.getElementById('drillProblem');
    var answerInput = document.getElementById('drillAnswer');

    var btnStart = document.getElementById('btnStart');
    var btnRetry = document.getElementById('btnRetry');
    var scoreValueEl = document.getElementById('drillScoreValue');
    var ratingBadgeEl = document.getElementById('drillRating');
    var resultStatsEl = document.getElementById('drillResultStats');

    var state = 'setup';
    var duration = 60;
    var correct = 0;
    var wrong = 0;
    var problemNum = 0;
    var currentAnswer = 0;
    var currentProblemText = '';
    var startTime = 0;
    var timerInterval = null;

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateProblem(operation, difficulty) {
      var ops = operation === 'mixed'
        ? ['addition', 'subtraction', 'multiplication', 'division']
        : [operation];
      var op = ops[randInt(0, ops.length - 1)];
      var a, b, answer, display;

      if (op === 'addition') {
        var mx = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 50 : 100;
        a = randInt(1, mx);
        b = randInt(1, mx);
        display = a + ' + ' + b + ' =';
        answer = a + b;
      } else if (op === 'subtraction') {
        var mx = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 50 : 100;
        a = randInt(1, mx);
        b = randInt(1, a);
        display = a + ' \u2212 ' + b + ' =';
        answer = a - b;
      } else if (op === 'multiplication') {
        var mxA = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 15;
        var mxB = difficulty === 'easy' ? 5 : 12;
        a = randInt(2, mxA);
        b = randInt(2, mxB);
        display = a + ' \u00d7 ' + b + ' =';
        answer = a * b;
      } else {
        var maxDiv = difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 15;
        b = randInt(2, maxDiv);
        answer = randInt(2, difficulty === 'easy' ? 5 : difficulty === 'medium' ? 12 : 20);
        a = b * answer;
        display = a + ' \u00f7 ' + b + ' =';
      }

      return { display: display, answer: answer };
    }

    function getRating(score) {
      for (var i = 0; i < ratingScale.length; i++) {
        if (score >= ratingScale[i].min) return ratingScale[i];
      }
      return ratingScale[ratingScale.length - 1];
    }

    function showSetup() {
      state = 'setup';
      setupPanel.style.display = '';
      playingPanel.style.display = 'none';
      resultPanel.style.display = 'none';
      controlsPanel.style.display = 'none';
      if (window.GameShare) window.GameShare.hide();
    }

    function startGame() {
      state = 'playing';
      duration = parseInt(cfgDuration.value, 10);
      correct = 0;
      wrong = 0;
      problemNum = 0;
      startTime = Date.now();

      setupPanel.style.display = 'none';
      playingPanel.style.display = '';
      resultPanel.style.display = 'none';
      controlsPanel.style.display = 'none';
      if (window.GameShare) window.GameShare.hide();

      correctEl.textContent = '0';
      wrongEl.textContent = '0';
      timeLeftEl.textContent = duration + 's';
      timerFill.style.width = '100%';
      timerFill.classList.remove('warning', 'danger');
      drillListEl.innerHTML = '';

      showNextProblem();
      answerInput.focus();
      timerInterval = setInterval(updateTimer, 50);
    }

    function showNextProblem() {
      problemNum++;
      var problem = generateProblem(cfgOperation.value, cfgDifficulty.value);
      currentAnswer = problem.answer;
      currentProblemText = problem.display;
      numEl.textContent = problemNum + ')';
      problemEl.textContent = problem.display;
      answerInput.value = '';
      answerInput.focus();
    }

    function submitAnswer() {
      if (state !== 'playing') return;
      var userAnswer = parseInt(answerInput.value, 10);
      if (isNaN(userAnswer)) return;

      var isCorrect = userAnswer === currentAnswer;
      var item = document.createElement('div');
      item.className = 'drill-item';

      if (isCorrect) {
        correct++;
        correctEl.textContent = String(correct);
        item.innerHTML =
          '<span class="drill-mark ok">\u2713</span>' +
          '<span class="drill-q">' + currentProblemText + '</span>' +
          '<span class="drill-a ok">' + userAnswer + '</span>';
      } else {
        wrong++;
        wrongEl.textContent = String(wrong);
        item.innerHTML =
          '<span class="drill-mark fail">\u2717</span>' +
          '<span class="drill-q">' + currentProblemText + '</span>' +
          '<span class="drill-a fail">' + userAnswer + '</span>' +
          '<span class="drill-correct-val">' + currentAnswer + '</span>';
      }

      drillListEl.appendChild(item);
      drillListEl.scrollTop = drillListEl.scrollHeight;
      showNextProblem();
    }

    function updateTimer() {
      var elapsed = (Date.now() - startTime) / 1000;
      var remaining = Math.max(0, duration - elapsed);
      var pct = (remaining / duration) * 100;
      timeLeftEl.textContent = Math.ceil(remaining) + 's';
      timerFill.style.width = pct + '%';

      if (pct <= 20) {
        timerFill.classList.add('danger');
        timerFill.classList.remove('warning');
      } else if (pct <= 40) {
        timerFill.classList.add('warning');
        timerFill.classList.remove('danger');
      }

      if (remaining <= 0) endGame();
    }

    function endGame() {
      state = 'result';
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }

      var totalAttempted = correct + wrong;
      var accuracy = totalAttempted > 0 ? Math.round((correct / totalAttempted) * 100) : 0;
      var rating = getRating(correct);

      playingPanel.style.display = 'none';
      resultPanel.style.display = '';
      controlsPanel.style.display = '';

      scoreValueEl.textContent = String(correct);
      ratingBadgeEl.textContent = rating.label;
      ratingBadgeEl.style.background = rating.color;

      resultStatsEl.innerHTML =
        '<span><strong>' + totalAttempted + '</strong>attempted</span>' +
        '<span><strong>' + accuracy + '%</strong>accuracy</span>' +
        '<span><strong>' + wrong + '</strong>wrong</span>' +
        '<span><strong>' + duration + 's</strong>duration</span>';

      saveAttempt(correct, rating.label);
      renderHistory();

      if (window.GameShare) {
        var gsv = window.__gameShareVars;
        window.GameShare.show({
          gameName: gsv.gameName,
          gameSlug: gsv.gameSlug,
          gameIcon: gsv.gameIcon,
          score: correct,
          unit: gsv.metricUnit,
          metricLabel: gsv.metricLabel,
          ratingLabel: rating.label,
          ratingColor: rating.color
        });
      }
    }

    btnStart.addEventListener('click', startGame);
    btnRetry.addEventListener('click', showSetup);
    answerInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') { e.preventDefault(); submitAnswer(); }
    });

    function loadHistory() {
      try {
        var raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        return JSON.parse(raw);
      } catch (e) { return []; }
    }

    function saveAttempt(score, rating) {
      var history = loadHistory();
      history.unshift({ score: score, rating: rating, timestamp: Date.now() });
      if (history.length > MAX_HISTORY) history.length = MAX_HISTORY;
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(history)); } catch (e) {}
    }

    function renderHistory() {
      var history = loadHistory();
      if (history.length === 0) { historySection.hidden = true; return; }
      historySection.hidden = false;
      historyListEl.innerHTML = '';
      for (var i = 0; i < history.length; i++) {
        var entry = history[i];
        var r = getRating(entry.score);
        var item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML =
          '<span class="history-score">' + entry.score + ' solved</span>' +
          '<span class="history-rating" style="background:' + r.color + '">' + entry.rating + '</span>' +
          '<span class="history-time">' + formatTimeAgo(entry.timestamp) + '</span>';
        historyListEl.appendChild(item);
      }
    }

    function formatTimeAgo(timestamp) {
      var diff = Date.now() - timestamp;
      var seconds = Math.floor(diff / 1000);
      if (seconds < 60) return 'just now';
      var minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + 'm ago';
      var hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + 'h ago';
      return Math.floor(hours / 24) + 'd ago';
    }

    renderHistory();
  })();
</script>
